# ç¨³éƒ¨è½ stablog

**ç¨³éƒ¨è½** ç”± [å§šæ³½æº](http://www.yaozeyuan.online/) åˆ›ä½œï¼Œé‡‡ç”¨ [MIT](http://opensource.org/licenses/MIT) åè®®è¿›è¡Œè®¸å¯ã€‚

- é¡¹ç›®åŸºäºå¾®åšç°æœ‰æ¥å£+TypeScript æ„å»ºï¼Œä¸ºå¾®åšç½‘å‹æä¾›ä¸€ä¸ªæ–¹ä¾¿çš„, ä»¥ä¾›è‡ªå·±é˜…è¯»/æ•°æ®å¤‡ä»½/è‡ªèº«ç»“é›†æ•´ç†çš„æ–¹å¼

**ä¸¥ç¦å°†æœ¬è½¯ä»¶åŠå…¶è¡ç”Ÿå“ç”¨äºä»»ä½•å•†ä¸šç”¨é€”**

æ¥å—åŠŸèƒ½å»ºè®®, ä½†ä¸€èˆ¬ä¸è€ƒè™‘å®šåˆ¶å¼€å‘

# è½¯ä»¶ä¸‹è½½

æœ€æ–°ç‰ˆæœ¬: 2.0.0

[ç‚¹å‡»ä¸‹è½½-win](http://stablog.bookflaneur.cn/release/%E7%A8%B3%E9%83%A8%E8%90%BD%20Setup%202.0.0.exe#)

[ç‚¹å‡»ä¸‹è½½-mac](http://stablog.bookflaneur.cn/release/%E7%A8%B3%E9%83%A8%E8%90%BD-2.0.0.dmg#)

[æ›´æ–°å†å²](./changelog.md)

# ä½¿ç”¨æŒ‡å—

1.  ç™»å½•å¾®åš. ç”±äºå¾®åšç½‘é¡µæœ¬èº«é—®é¢˜, è¾“å…¥è´¦å·/å¯†ç /éªŒè¯ç æ—¶ç•¥æœ‰å¡é¡¿, è¯·è€å¿ƒç­‰å¾…

2.  è¿›å…¥ç³»ç»Ÿè®¾ç½®, å°†ä¸ªäººä¸»é¡µåœ°å€ç²˜è´´è¿›è¾“å…¥æ . ç‚¹å‡»`åŒæ­¥ä¸ªäººä¿¡æ¯`æŒ‰é’®, å¯çœ‹åˆ°é¢„ä¼°çš„å¤‡ä»½æ—¶é•¿, ç‚¹å‡»`å¼€å§‹å¤‡ä»½`, æ‰§è¡Œå¤‡ä»½æ“ä½œ.
3.  å¤‡ä»½å®Œæˆåä¼šè‡ªåŠ¨æ‰“å¼€ç”µå­ä¹¦è¾“å‡ºç›®å½•, `ç¨³éƒ¨è½è¾“å‡ºçš„ç”µå­ä¹¦`ç›®å½•ä¸‹, å³ä¸ºç”µå­ä¹¦, å…¶ä¸­, `html`ç›®å½•ä¸‹ä¸º html æ ¼å¼ä¹¦ç±, `index.html`ä¸ºç›®å½•é¡µ. `pdf`ä¸‹ä¸º pdf è¾“å‡ºä½ç½®

1)  ![ç™»å½•å¾®åš](http://stablog.bookflaneur.cn//img/%E7%99%BB%E5%BD%95%E5%BE%AE%E5%8D%9A.jfif)
2)  ![é…ç½®ä»»åŠ¡](http://stablog.bookflaneur.cn//img/%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4-6.png)
3)  ![æŸ¥çœ‹ç”µå­ä¹¦](http://stablog.bookflaneur.cn//img/%E6%9F%A5%E7%9C%8B%E8%BE%93%E5%87%BA%E7%9A%84%E7%94%B5%E5%AD%90%E4%B9%A6.jfif)

# ä½¿ç”¨æˆªå›¾

è½¯ä»¶ç•Œé¢:

![ä¸»ç•Œé¢|675x499](http://stablog.bookflaneur.cn/img/v2/%E4%B8%BB%E7%95%8C%E9%9D%A2.png)
![é…ç½®åˆ—è¡¨|690x392](http://stablog.bookflaneur.cn/img/v2/%E9%85%8D%E7%BD%AE%E5%88%97%E8%A1%A8.png)

è¿è¡Œæˆªå›¾

![è¿è¡Œæˆªå›¾|644x500](http://stablog.bookflaneur.cn/img/v2/%E8%BF%90%E8%A1%8C%E6%88%AA%E5%9B%BE.png)

è¾“å‡ºçš„æ–‡ä»¶:

![è¾“å‡ºçš„æ–‡ä»¶|690x287](http://stablog.bookflaneur.cn/img/v2/%E8%BE%93%E5%87%BA%E7%9A%84%E6%96%87%E4%BB%B6.png)

è¾“å‡ºçš„ html ç”µå­ä¹¦:

![è¾“å‡ºçš„htmlç”µå­ä¹¦|496x500](http://stablog.bookflaneur.cn/img/v2/%E8%BE%93%E5%87%BA%E7%9A%84html%E7%94%B5%E5%AD%90%E4%B9%A6.png)

è¾“å‡ºçš„ pdf ç”µå­ä¹¦:

![è¾“å‡ºçš„pdfç”µå­ä¹¦|403x500](http://stablog.bookflaneur.cn/img/v2/%E8%BE%93%E5%87%BA%E7%9A%84pdf%E7%94%B5%E5%AD%90%E4%B9%A6.jpeg)

## é¡¹ç›®åŠ¨æœº

ä¸¥è‚ƒä¿æŠ¤ä»¥[@Aioros å…ˆç”Ÿ](https://weibo.com/u/6646798696?refer_flag=0000015010_&from=feed&loc=nickname&sudaref=www.weibo.com&is_all=1)ä¸ºä»£è¡¨çš„çç¨€é‡ç”Ÿè¯»ç‰©åšä¸»

# é…ç½®é¡¹è¯´æ˜

1.  å¤‡ä»½é¡µæ•°: ä»ç¬¬ m é¡µå¤‡ä»½åˆ°ç¬¬ n é¡µ
    1.  é™¤é¦–æ¬¡å¤‡ä»½å¤–, æ­£å¸¸ä½¿ç”¨åªè¦å¤‡ä»½å‰ 10 é¡µå¾®åšå³å¯, å¯ä»¥åŠ å¿«å¤‡ä»½é€Ÿåº¦
2.  å¾®åšæ’åº
    1.  æŒ‰å¾®åšå‘å¸ƒæ—¶é—´è¿›è¡Œæ’åº. ç²¾ç¡®åº¦ä¸º`å¤©`. å»ºè®®ä½¿ç”¨`ç”±æ—§åˆ°æ–°`æ¨¡å¼, ç¬¦åˆé˜…è¯»ä¹ æƒ¯
3.  å›¾ç‰‡é…ç½®
    1.  ç”µå­ä¹¦å†…æ˜¯å¦åŒ…å«å›¾ç‰‡. å»ºè®®é€‰æ‹©`æœ‰å›¾`æ¨¡å¼
4.  è‡ªåŠ¨åˆ†å·
    1.  è§£å†³ç”µå­ä¹¦ä½“ç§¯è¿‡å¤§é—®é¢˜. å¦‚æœå•æœ¬ç”µå­ä¹¦å†…å¾®åšæ€»æ•°è¶…å‡ºé…ç½®å€¼, å°†ä¼šåˆ†ä¸ºå¤šå·è¾“å‡º
5.  æ—¶é—´èŒƒå›´
    1.  åªè¾“å‡ºæŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„å¾®åšè®°å½•.
6.  åˆ†é¡µä¾æ®
    1.  html ç‰ˆç”µå­ä¹¦å†…, æŒ‰ä»€ä¹ˆæ ‡å‡†åˆå¹¶å¾®åš. æ¨è`æŒ‰æœˆ`åˆå¹¶å¾®åš. è¯ç—¨åšä¸»å¯ä»¥`æŒ‰å¤©`, ä¸å–œæ¬¢è¯´è¯çš„åšä¸»å¯ä»¥`æŒ‰å¹´`

# Q & A

é—®: è½¯ä»¶å®‰å…¨å—, ä¸ºä»€ä¹ˆä¸€å®šè¦ç™»å½•åæ‰èƒ½ä½¿ç”¨?
ç­”: ä½œè€…å¯ä»¥ä¿è¯ä»é¡¹ç›® Github ä¸»é¡µä¸Šä¸‹è½½çš„è½¯ä»¶å®‰å…¨å¯é . é¡¹ç›®æºä»£ç å¼€æ”¾, å®åœ¨ä¸æ”¾å¿ƒå¯ä»¥åŸºäºæºä»£ç è‡ªè¡Œç¼–è¯‘. ç”±äºæ˜¯å¾®åšå¤‡ä»½é¡¹ç›®,åªæœ‰ç™»å½•è‡ªå·±çš„å¾®åšè´¦å·åæ‰èƒ½çœ‹åˆ°å‘å¸ƒçš„æ‰€æœ‰å¾®åš, æ‰€ä»¥å¿…é¡»è¦ç™»å½•.

é—®: ä¸ºä»€ä¹ˆå¤‡ä»½è¿™ä¹ˆæ…¢? ä¸ºä»€ä¹ˆæ¯æ¬¡éƒ½è¦ç­‰ 20s ä¹‹åæ‰æŠ“å–ä¸‹ä¸€æ¡å¾®åš?
ç­”: æ–°æµªå¯¹çˆ¬è™«è¿›è¡Œäº†ä¸¥æ ¼é™åˆ¶, 20s æŠ“ä¸€æ¬¡æ˜¯æˆ‘è¯•éªŒå¤šæ¬¡ä¹‹å, å¯ä»¥å®‰å…¨å¤‡ä»½å¾®åšæ•°æ®çš„æœ€çŸ­é—´éš”. ä½œä¸ºä¸ºéå¼€å‘äººå‘˜æä¾›çš„å¤‡ä»½å·¥å…·, **ç¨³å®š**ç¬¬ä¸€ ğŸµ

é—®: å®‰è£…å®Œä¹‹åæ— æ³•è¿è¡Œ, å¼¹æ¡†æç¤º:"A JavaScript error occurred in main process" æ˜¯æ€ä¹ˆå›äº‹?
ç­”: ä¸€èˆ¬æ˜¯å› ä¸ºè½¯ä»¶æ²¡æœ‰å†™å…¥æ–‡ä»¶æƒé™, æ”¹è£…åˆ° D ç›˜å°±å¯ä»¥äº†

# ä»£ç è§„èŒƒ

1.  å˜é‡å‘½åè§„èŒƒ
    1.  ç±»å‹ç»Ÿä¸€ä½¿ç”¨ namespace æ–¹å¼å£°æ˜, å¯¼å…¥æ—¶ä½¿ç”¨`Type + xxx`å½¢å¼è¿›è¡Œå¯¼å…¥
    2.  Model å¯¼å…¥æ—¶ç»Ÿä¸€ä½¿ç”¨`M + xxx`å½¢å¼è¿›è¡Œå¯¼å…¥
    3.  View å¯¼å…¥æ—¶ç»Ÿä¸€ä½¿ç”¨`View + xxx`å½¢å¼è¿›è¡Œå¯¼å…¥
    4.  Util å·¥å…·å‡½æ•°å¯¼å…¥æ—¶ç»Ÿä¸€ä½¿ç”¨`xxx + Util`å½¢å¼è¿›è¡Œå¯¼å…¥
    5.  async å‡½æ•°å‰ç»Ÿä¸€æ·»åŠ `async`å‰ç¼€, ä»¥å’Œæ­£å¸¸å‡½æ•°è¿›è¡ŒåŒºåˆ†
2.  æ–‡ä»¶å‘½åè§„èŒƒ
    1.  ç»Ÿä¸€ä½¿ç”¨ä¸‹åˆ’çº¿æ–¹å¼å‘½å

# å¼€å‘è¯´æ˜

0.  å¿…é¡»ä½¿ç”¨ node12
    1.  Electron ç‰ˆæœ¬å¿…é¡»å’Œç¯å¢ƒä¸­çš„ node ç‰ˆæœ¬ä¸€è‡´, æ‰èƒ½æ­£å¸¸ç¼–è¯‘ sqlite
        1.  ç›®å‰ä½¿ç”¨çš„æ˜¯ Electron@6.0.12, è‡ªå¸¦ node ä¸º 12.4.0, å› æ­¤è¦æ±‚ç¯å¢ƒ node ä¹Ÿéœ€è¦ä¸º 12.x.x
1.  å»ºè®®åªå¼€å‘å‘½ä»¤ç‰ˆ
    1.  ä½¿ç”¨`npm run ace`å¯åŠ¨
1.  GUI ç‰ˆéœ€è¦ä¸º Electron ç¼–è¯‘ sqlite3, éå¸¸éº»çƒ¦, ä¸å»ºè®®å°è¯•
    1.  æµç¨‹
        1.  Windows ç”¨æˆ·
            1.  å®‰è£…[VS 2019 ç¤¾åŒºç‰ˆ](https://visualstudio.microsoft.com/zh-hans/downloads/), ç¤¾åŒºç‰ˆå…è´¹ä¸‹è½½. Windows ä¸‹ä¸º Electron ç¼–è¯‘ sqlite3 éœ€è¦ VS æä¾›çš„æ„å»ºå·¥å…·
            2.  å¯åŠ¨ VS, é€‰æ‹©`å·¥å…·`-`è·å–å·¥å…·å’ŒåŠŸèƒ½`
            3.  å‹¾é€‰`ä½¿ç”¨C++çš„æ¡Œé¢å¼€å‘`-`MSVC v140 - VS 2015 C++ç”Ÿæˆå·¥å…·(v14.00)`, å®‰è£…å³å¯
            4.  å¥½äº†ä¸€ä¸ªå°æ—¶è¿‡å»äº†
            5.  æ‰§è¡Œ `npm run rebuild-sqlite3`, ç¼–è¯‘å®Œæˆ sqlite3 ä¹‹å, å°±å¯ä»¥å¯åŠ¨ GUI ç•Œé¢äº†
            6.  ç‰¹åˆ«è¯´æ˜: è¿™å¥—æµç¨‹åªé€‚åˆçº¯å‡€ç¯å¢ƒ, å¦‚æœæ˜¯`Electron@4`å‡çº§åˆ°`Electron@6`, å†ç¼–è¯‘ä¼šç¼–è¯‘ä¸è¿‡å»(ä¼šæœ‰ v4 çš„ç¼–è¯‘æ®‹ç•™), å°†æ•´ä¸ª`node_modules`ç›®å½•åˆ é™¤åé‡æ–°`install`å³å¯
        2.  Mac ç”¨æˆ·
            1.  æ­£å¸¸`npm install`å³å¯, æ³¨æ„å®‰è£…`puppeteer`å’Œ`electron`æœ¬èº«éå¸¸è€—æ—¶, éœ€è¦ä½¿ç”¨æ·˜å®æºè¿›è¡Œä¸‹è½½`--registry=https://registry.npm.taobao.org/`
    2.  æ³¨æ„:
        1.  æ‰“åŒ…æ—¶ä¼šå‘ dist ç›®å½•ä¸­å¤åˆ¶ä¸€ä»½ node_modules ç›®å½•, å¯¼è‡´ npm run æ—¶ä¼˜å…ˆä» dist ä¸­è·å– node_module ä¿¡æ¯, å¯¼è‡´æ— æ³•å¯åŠ¨
            1.  å› æ­¤, æ‰“åŒ…ç»“æŸåéœ€è¦å°† dist é‡Œçš„ node_modules ç›®å½•åˆ æ‰, ä»¥å…å½±å“åç»­å¼€å‘å·¥ä½œ
1.  ç”µå­ä¹¦å°é¢åˆ†è¾¨ç‡ä¸º: 100 * 130(å®½*é«˜)

## commit ä¿¡æ¯è§„èŒƒ

| å…³é”®å­— | åŠŸèƒ½          |
| ------ | ------------- |
| feat   | æ·»åŠ æ–°åŠŸèƒ½    |
| format | è°ƒæ•´ä»£ç æ ¼å¼  |
| fix    | ä¿®å¤é”™è¯¯      |
| doc    | ä¿®è®¢æ–‡æ¡£/æ³¨é‡Š |

# å¼€å‘æŒ‡å—

## åŸºæœ¬æ€è·¯

1.  TypeScript æä¾›ç±»å‹æ”¯æŒ, åœ¨ç¼–å†™ä»£ç æ—¶å¯ä»¥è‡ªåŠ¨æç¤ºå˜é‡ä¸‹çš„å±æ€§
2.  Electron æä¾›å›¾å½¢ç•Œé¢, åˆ©ç”¨ webview æ ‡ç­¾ç›´æ¥ç™»å½•å¾®åš
3.  åˆ©ç”¨å¾®åšæ¥å£æŠ“å–æ•°æ®
4.  ace/command æä¾›å‘½ä»¤è¡Œæ”¯æŒ
5.  sqlite3 æä¾›æ•°æ®åº“æ”¯æŒ

## å®ç°æ–¹å¼

1.  å°†ç”µå­ä¹¦åˆ¶ä½œåˆ†ä¸ºä»¥ä¸‹ä¸‰æ­¥
    1.  åˆå§‹åŒ–ç¯å¢ƒ => å¯¹åº”äº`npm run ace Init:Env`å‘½ä»¤
    2.  æŠ“å–æŒ‡å®šå†…å®¹ => å¯¹åº”äº`npm run ace Fetch:XXX`ç³»åˆ—å‘½ä»¤, ç›®å‰æ”¯æŒ`Column`/`Author`/`Activity`/`Collection`/`Topic`
    3.  ä»æ•°æ®åº“ä¸­è·å¾—æ•°æ®, ç”ŸæˆæŒ‡å®šå†…å®¹ç”µå­ä¹¦ => å¯¹åº”äº`npm run ace Generate:XXX`ç³»åˆ—å‘½ä»¤, ç›®å‰æ”¯æŒ`Column`/`Author`/`Activity`/`Collection`/`Topic`
    4.  å› æ­¤, å®é™…ä»»åŠ¡æµç¨‹å°±æ˜¯æ ¹æ®ç”¨æˆ·è¾“å…¥ url, ç”Ÿæˆå¯¹åº”å‘½ä»¤é…ç½®, ä¸æ–­æ‰§è¡Œå‘½ä»¤å³å¯
2.  é¡¹ç›®å¼€å‘æµç¨‹
    1.  `npm run watch` å¯åŠ¨ç›‘æ§, å°†`ts`è‡ªåŠ¨ç¼–è¯‘ä¸º`js`æ–‡ä»¶
    2.  `npm run startgui`, å¯åŠ¨å‰ç«¯ç•Œé¢(vue é¡¹ç›®, åŸºäº Element-UI ç®€å•æ„å»º)
    3.  æ‰§è¡Œ`npm run start`, ä»¥è°ƒè¯•æ¨¡å¼å¯åŠ¨ Electron
        1.  å‰ç«¯ç‚¹å‡»`å¼€å§‹ä»»åŠ¡`æŒ‰é’®å, å°†ä»»åŠ¡é…ç½®å†™å…¥`task_config_list.json`, å†ç”± Electron æ”¶é›†ç™»å½•åäº§ç”Ÿçš„å¾®åš cookie, å­˜å…¥`config.json`æ–‡ä»¶ä¸­, éšåå¯åŠ¨`Dispatch:Command`å‘½ä»¤, å¼€å§‹æ‰§è¡Œä»»åŠ¡
3.  é¡¹ç›®å‘å¸ƒ
    1.  æ‰§è¡Œ`npm run dist`
4.  æ³¨æ„äº‹é¡¹
    1.  Electron éœ€è¦ç¼–è¯‘ sqlite3 åæ‰èƒ½å¯åŠ¨, ä¸å®¹æ˜“æ, å»ºè®®ç›´æ¥ä½¿ç”¨`npm run ace`å‘½ä»¤è¡Œæ–¹å¼è¿›è¡Œè°ƒè¯•
    2.  å‘½ä»¤ä½¿ç”¨è¯´æ˜è¯¦è§ä»£ç 

# windows ç¯å¢ƒä¸‹ puppeteer å®‰è£…æŒ‡å—

1.  é¦–å…ˆ, `$env:PUPPETEER_DOWNLOAD_HOST=https://storage.googleapis.com.cnpmjs.org/`é…ç½®ç¯å¢ƒå˜é‡, é…ç½® chrome é•œåƒæº
2.  `npm install puppeteer@1.20.0 -S`å®‰è£… puppeteer ä»£ç 
3.  `npm run install-puppeteer-dependencies`å®‰è£… 32/64 ä½ç‰ˆæœ¬ chrome

# mac ç¯å¢ƒä¸‹ puppeteer å®‰è£…æŒ‡å—

1.  ç›´æ¥æ‰§è¡Œ `PUPPETEER_DOWNLOAD_HOST=https://storage.googleapis.com.cnpmjs.org/ npm install puppeteer@1.20.0 -S`

# åŠŸèƒ½å»ºè®®

æ¬¢è¿é€šè¿‡[issue](https://github.com/YaoZeyuan/stablog/issues)æå»ºè®®

# æ”¯æŒä½œè€…

![è€é“,è°¢è°¢äº†](http://stablog.bookflaneur.cn//img/%E8%80%81%E9%93%81%E8%B0%A2%E8%B0%A2%E4%BA%86.jfif?date=20191213)
